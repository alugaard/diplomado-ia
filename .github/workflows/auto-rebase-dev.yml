name: Auto Rebase Dev Branch

on:
  # Trigger this workflow when any pull request is closed (merged) on the 'main' branch
  pull_request:
    types: [closed]
    branches:
      - main  # Or your default branch name (e.g., 'master')

jobs:
  rebase:
    # Only run the job if the PR was actually merged, not just closed
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Main Branch
        uses: actions/checkout@v4
        with:
          # Use a Personal Access Token (PAT) with 'write' access
          # or the default GITHUB_TOKEN with elevated permissions,
          # and fetch the full history (depth: 0) for rebasing
          token: ${{ secrets.REBASE_PAT }}
          ref: main

      - name: üîÑ Checkout Dev Branch
        run: git checkout dev

      - name: ‚öôÔ∏è Rebase Dev onto Main
        run: |
          # Fetch the latest state of the dev branch before rebase
          git fetch origin dev
          # Reset the local dev branch to the remote dev branch
          git reset --hard origin/dev
          # Rebase dev onto main
          git rebase main

      - name: ‚¨ÜÔ∏è Force Push Rebased Dev Branch
        run: git push --force
